<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Rekap Absensi Bulanan</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    table { border-collapse: collapse; width: 100%; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    th.rotate { writing-mode: vertical-rl; transform: rotate(180deg); }
    input { margin: 0.5rem 0; }
  </style>
</head>
<body>
  <h2>Rekap Absensi Bulanan</h2>
  <label for="bulan">Pilih Bulan (MM/YYYY):</label>
  <input type="text" id="bulan" placeholder="04/2025" />
  <label for="nama">Filter Nama:</label>
  <input type="text" id="nama" placeholder="Nama Karyawan" />
  <button onclick="loadRekap()">Tampilkan</button>
  <br><br>
  <div id="rekapContainer">Loading...</div>

  <script>
    function loadRekap() {
      const bulan = document.getElementById("bulan").value;
      const nama = document.getElementById("nama").value;
      const url = https://script.google.com/macros/s/AKfycbyHNtF8g4dAHj3KSecEfzvT5ebK1F5-OoEDGD2ledTuEbZmCANg_CGQhocy_o8tlgJ0/exec?action=rekap&bulan=${encodeURIComponent(bulan)}&nama=${encodeURIComponent(nama)};
      document.getElementById("rekapContainer").innerHTML = "Loading...";

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (!data.success) throw new Error(data.message);
          renderTable(data);
        })
        .catch(err => {
          document.getElementById("rekapContainer").innerText = "Error: " + err.message;
        });
    }

    function renderTable(data) {
      let html = "<table><thead><tr><th>Nama Karyawan</th>";
      data.tanggal.forEach(tgl => {
        html += <th>${tgl} Masuk</th><th>${tgl} Pulang</th>;
      });
      html += "</tr></thead><tbody>";

      data.rekap.forEach(row => {
        html += <tr><td>${row.nama}</td>;
        data.tanggal.forEach(tgl => {
          html += <td>${row.masuk[tgl] || "-"}</td><td>${row.pulang[tgl] || "-"}</td>;
        });
        html += "</tr>";
      });

      html += "</tbody></table>";
      document.getElementById("rekapContainer").innerHTML = html;
    }

    // Load default bulan ini
    document.getElementById("bulan").value = new Date().toLocaleDateString("id-ID", { month: '2-digit', year: 'numeric' });
    loadRekap();
  </script>
</body>
</html>
