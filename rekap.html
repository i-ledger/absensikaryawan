<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Rekap Absensi Bulanan</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    table { border-collapse: collapse; width: 100%; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    input { margin: 0.5rem 0.5rem 0.5rem 0; }
  </style>
</head>
<body>
  <h2>Rekap Absensi</h2>
  <label for="start">Dari Tanggal:</label>
  <input type="text" id="start" placeholder="01/04/2025" />
  <label for="end">Sampai:</label>
  <input type="text" id="end" placeholder="10/04/2025" />
  <label for="nama">Filter Nama:</label>
  <input type="text" id="nama" placeholder="Nama Karyawan" />
  <button onclick="loadRekap()">Tampilkan</button>
  <br><br>
  <div id="rekapContainer">Loading...</div>

  <script>
    function loadRekap() {
      const start = document.getElementById("start").value;
      const end = document.getElementById("end").value;
      const nama = document.getElementById("nama").value;

      const url = `https://script.google.com/macros/s/AKfycbx6BLcrnV0F_bD3pv0j2uUvmzh8Cf3eNT1BWnuFA1f7P59QHAtC83taTL8JNpjm5Bbq/exec?action=rekap&start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}&nama=${encodeURIComponent(nama)}`;
      
      document.getElementById("rekapContainer").innerHTML = "Loading...";

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (!data.success) throw new Error(data.message);
          renderTable(data);
        })
        .catch(err => {
          document.getElementById("rekapContainer").innerText = "Error: " + err.message;
        });
    }

    function renderTable(data) {
      let html = "<table><thead><tr><th>Nama Karyawan</th>";
      data.tanggal.forEach(tgl => {
        html += `<th>${tgl} Masuk</th><th>${tgl} Pulang</th>`;
      });
      html += "</tr></thead><tbody>";

      data.rekap.forEach(row => {
        html += `<tr><td>${row.nama}</td>`;
        data.tanggal.forEach(tgl => {
          html += `<td>${row.masuk[tgl] || "-"}</td><td>${row.pulang[tgl] || "-"}</td>`;
        });
        html += "</tr>";
      });

      html += "</tbody></table>";
      document.getElementById("rekapContainer").innerHTML = html;
    }

    // Default isi dengan tanggal awal dan akhir bulan ini
    const today = new Date();
    const first = new Date(today.getFullYear(), today.getMonth(), 1);
    const last = new Date(today.getFullYear(), today.getMonth() + 1, 0);
    document.getElementById("start").value = first.toLocaleDateString("id-ID");
    document.getElementById("end").value = last.toLocaleDateString("id-ID");

    loadRekap();
  </script>
</body>
</html>
